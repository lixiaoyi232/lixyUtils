{% extends "../layout/layout-member-center.html" %}

{% block css %}
{{ super() }}
<style>
  #myForm1 .layui-input, #myForm1 .layui-textarea, #myForm2 .layui-input, #myForm2 .layui-textarea  {
    font-size: 14px;
  }
  #myForm1, #myForm2 {
    padding: 20px 0 0 250px;
  }
</style>
{% endblock %}

{% block member_center_main %}
<div class="layui-card myCard">
  <div class="layui-card-header">修改信息</div>
  <div class="layui-card-body layui-tab layui-tab-brief">
    <div id="myForm1"></div>
  </div>
</div>


{% if curMember.type == MemberType.student %}
<!-- <div class="layui-card myCard">
  <div class="layui-card-header">学校变更 &nbsp;&nbsp;&nbsp; <span class="notice">注意：升学、转学等情况需审核后才能生效。</span></div>
  <div class="layui-card-body layui-tab layui-tab-brief">
      <div id="myForm2"></div>
  </div>
</div> -->
{% endif %}



{% endblock %}

{% block script %}
  {{ super() }}
  <script>
    var isChina = {% if curMember.country.number == 1 %}true{% else %}false{% endif %}
    $(function () {
      {% if curMember.type == MemberType.student %}
      newForm({
        parent: '#myForm1',
        form: {
          labelWidth: '120',
          done: function () {
            $('[lay-filter="myForm1Submit"]').css('marginTop', 30)
          },
          submit: {
            'class': 'layui-btn brownBtn layui-btn-lg lgWidth',
            event: function (data) {
              $('[lay-filter="myForm1Submit"]').attr('disabled', true)
              $('[lay-filter="myForm1Submit"]').addClass('layui-btn-disabled')
              ajax({
                method: 'POST',
                url: '/member-center/info-edit',
                data: JSON.stringify(data.field),
                success: function () {
                  layui.layer.msg('操作成功',{ time: 1000 })
                  window.setTimeout(function () {
                    location.href = '/member-center/info'
                  }, 1100)
                  // layer.msg('修改成功', {time: 2000, icon:6})
                  // parent.tableRender()
                  // window.setTimeout(function () {parent.layer.close(parent.layer.getFrameIndex(window.name))}, 2000)
                },
                fail: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                },
                error: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                }
              })
            }
          },
          val: {
            // 'nickName': '{{ curMember.nickName }}',
            'gender': '{{ curMember.gender }}',
            'nation': '{{ curMember.nation }}',
            'phoneNumber': '{{ curMember.phoneNumber }}',
            'address': '{{ curMember.student.address }}',
            'photo': '{{ curMember.student.photo }}',
            'avatar': '{{ curMember.avatar }}',
            'email': '{{ curMember.email }}',
            'wechat': '{{ curMember.wechat }}',
            'qq': '{{ curMember.qq }}',
            'intro': decodeURIComponent('{{ curMember.intro }}'),
            'grade': '{{ curMember.student.grade }}',
            'class': '{{ curMember.student.class }}',
          },
          items: [
            {
              label: '姓名',
              elements: {
                eType: 'char',
                name: 'name',
                element: '<div class="layui-input-block" style="">{{ curMember.name }} &nbsp;&nbsp;&nbsp; <span class="notice">注意： 如果需要修改，请联系网站管理员。</span></div>'
              }
            },
            {
              label: '身份证号',
              elements: {
                eType: 'char',
                name: 'idCard',
                element: '<div class="layui-input-block" style="">{{ curMember.idCard }} &nbsp;&nbsp;&nbsp; <span class="notice">注意： 如果需要修改，请联系网站管理员。</span></div>'
              }
            },
            // {
            //   label: '昵称',
            //   elements: {
            //     eType: 'input',
            //     name: 'nickName',
            //     layVerify: 'required'
            //   }
            // },
            {
              label: '性别',
              elements: {
                eType: 'select',
                name: 'gender',
                layVerify: 'select',
                option: [
                  {value: 'null', label: '请选择'},
                  {% for i, j in Gender %}
                  {value: '{{ j }}', label: '{{ j }}'},
                  {% endfor %}
                ],
              }
            },
            {
              label: '民族',
              elements: {
                eType: 'input',
                name: 'nation',
                layVerify: ''
              }
            },
            {
              label: '联系手机',
              elements: {
                eType: 'input',
                name: 'phoneNumber',
                layVerify: 'required|phone'
              }
            },
            {
              label: '住址',
              elements: {
                eType: 'input',
                name: 'address',
                layVerify: 'required'
              }
            },
            {
              label: '本人照片',
              elements: {
                eType: 'file',
                name: 'photo',
                btnClass: 'layui-btn greenBtn',
              }
            },
            {
              label: '头像',
              elements: {
                eType: 'file',
                name: 'avatar',
                layVerify: '',
                btnClass: 'layui-btn greenBtn'
              }
            },
            {
              label: 'Email',
              elements: {
                eType: 'input',
                name: 'email',
                layVerify: ''
              }
            },
            {
              label: '微信号',
              elements: {
                eType: 'input',
                name: 'wechat',
                layVerify: ''
              }
            },
            {
              label: 'QQ',
              elements: {
                eType: 'input',
                name: 'qq',
                layVerify: ''
              }
            },
            {
              label: '简介',
              elements: {
                eType: 'textarea',
                name: 'intro',
                layVerify: ''
              }
            },
            {
              label: '年级',
              elements: {
                eType: 'select',
                name: 'grade',
                layVerify: 'select',
                option: [
                  {value: 'null', label: '请选择'},
                  {value: '1', label: '1'},
                  {value: '2', label: '2'},
                  {value: '3', label: '3'},
                  {% if curMember.student.period == StudentPeriod.XiaoXue %}
                  {value: '4', label: '4'},
                  {value: '5', label: '5'},
                  {value: '6', label: '6'},
                  {% endif %}
                ]
              }
            },
            {
              label: '班级',
              elements: {
                eType: 'input',
                name: 'class',
                layVerify: 'required'
              }
            },
          ],
          verify: {
            select: function (value) {
              if (value === '' || value === 'null') return '必填项不能为空'
            },
          }
        }
      })
      {% elif curMember.type == MemberType.teacher %}
      newForm({
        parent: '#myForm1',
        form: {
          labelWidth: '120',
          done: function () {
            $('[lay-filter="myForm1Submit"]').css('marginTop', 30)
          },
          submit: {
            'class': 'layui-btn brownBtn layui-btn-lg lgWidth',
            event: function (data) {
              $('[lay-filter="myForm1Submit"]').attr('disabled', true)
              $('[lay-filter="myForm1Submit"]').addClass('layui-btn-disabled')
              ajax({
                method: 'POST',
                url: '/member-center/info-edit',
                data: JSON.stringify(data.field),
                success: function () {
                  layui.layer.msg('操作成功',{ time: 1000 })
                  window.setTimeout(function () {
                    location.href = '/member-center/info'
                  }, 1100)
                  // layer.msg('修改成功', {time: 2000, icon:6})
                  // parent.tableRender()
                  // window.setTimeout(function () {parent.layer.close(parent.layer.getFrameIndex(window.name))}, 2000)
                },
                fail: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                },
                error: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                }
              })
            }
          },
          val: {
            'name': '{{ curMember.name }}',
            'nickName': '{{ curMember.nickName }}',
            'gender': '{{ curMember.gender }}',
            'nation': '{{ curMember.nation }}',
            'idCard': '{{ curMember.idCard }}',
            'intro': decodeURIComponent('{{ curMember.intro }}'),
            'phoneNumber': '{{ curMember.phoneNumber }}',
            'address': '{{ curMember.teacher.address }}',
            'bankNumber': '{{ curMember.teacher.bankNumber }}',
            'bank': '{{ curMember.teacher.bank }}',
            'bankUser': '{{ curMember.teacher.bankUser }}',
            'avatar': '{{ curMember.avatar }}',
            'email': '{{ curMember.email }}',
            'wechat': '{{ curMember.wechat }}',
            'qq': '{{ curMember.qq }}',
            'schoolId': '{{ curMember.teacher.school.id }}',
          },
          items: [
            {
              label: '姓名',
              elements: {
                eType: 'input',
                name: 'name',
                layVerify: 'required'
              }
            },
            {
              label: '昵称',
              elements: {
                eType: 'input',
                name: 'nickName',
                layVerify: 'required'
              }
            },
            {
              label: '性别',
              elements: {
                eType: 'select',
                name: 'gender',
                option: [
                  {value: 'null', label: '请选择'},
                  {% for i, j in Gender %}
                  {value: '{{ j }}', label: '{{ j }}'},
                  {% endfor %}
                ],
              }
            },
            {
              label: '民族',
              elements: {
                eType: 'input',
                name: 'nation',
              }
            },
            {
              label: '身份证号',
              elements: {
                eType: 'input',
                name: 'idCard',
              }
            },
            {
              label: '联系手机',
              elements: {
                eType: 'input',
                name: 'phoneNumber',
                layVerify: 'required|phone'
              }
            },
            {
              label: '住址',
              elements: {
                eType: 'input',
                name: 'address',
              }
            },
            {
              label: '头像',
              elements: {
                eType: 'file',
                name: 'avatar',
                btnClass: 'layui-btn greenBtn'
              }
            },
            {
              label: 'Email',
              elements: {
                eType: 'input',
                name: 'email',
                layVerify: ''
              }
            },
            {
              label: '微信号',
              elements: {
                eType: 'input',
                name: 'wechat',
                layVerify: ''
              }
            },
            {
              label: 'QQ',
              elements: {
                eType: 'input',
                name: 'qq',
                layVerify: ''
              }
            },
            {
              label: '简介',
              elements: {
                eType: 'textarea',
                name: 'intro',
                layVerify: ''
              }
            },
            {
              label: '学校',
              elements: [
                {
                  eType: 'char',
                  name: 'schoolShow',
                  element: '<div class="layui-form-label"><button type="button" class="inblk layui-btn layui-btn-primary">修改学校</button></div><div class="layui-input-block schools" style="">{{ curMember.teacher.school.member.name }}</div>',
                  events: [
                    {
                      type: 'delegate',
                      name: 'click',
                      query: 'button',
                      callback: function (e) {
                        var index = layer.open({
                          type: 1,
                          title: '选择学校',
                          offset: ['5px', '5px'],
                          skin: 'layui-layer-rim',
                          area: [(document.body.clientWidth - 20) + 'px', (document.body.clientHeight - 20) + 'px'],
                          content: '<div id="chooseSch"></div>',
                          maxmin: true
                        })
                        newTable({
                          parent: '#chooseSch',
                          btns: {
                            items: [
                              {
                                layEvent: 'backSch',
                                'class': 'layui-btn greenBtn',
                                label: '确认选择',
                                event: function (obj, config, render) {
                                  var data = table.checkStatus(config.id).data
                                  if (data.length === 0) layer.close(index)
                                  else if (data.length > 0) {
                                    $('[name=schoolId]').val(data[0].school.id)
                                    $('.schools').html(data[0].name)
                                    layer.close(index)
                                  }
                                }
                              },
                              {
                                layEvent: 'cancelSch',
                                label: '取消',
                                event: function (obj, config, render) {layer.close(index)}
                              }
                            ]
                          },
                          search: {
                            'class': 'selects',
                            labelWidth: '100',
                            submit: {
                              'class': 'layui-btn greenBtn'
                            },
                            items: [
                              {
                                label: '会员学校',
                                elements: {
                                  eType: 'select',
                                  name: 'schoolVerifyIn',
                                  option: [
                                    {value: 'all', label: '&nbsp;', selected: true},
                                    {value: '{{ VerifyStatus.ok }}', label: '是'},
                                    {value: '{{ VerifyStatus.wait }},{{ VerifyStatus.no }}', label: '否'},
                                  ]
                                }
                              },
                              {
                                label: '学校编号',
                                elements: {
                                  eType: 'input',
                                  name: 'account'
                                }
                              },
                              {
                                label: '学校名称',
                                elements: {
                                  eType: 'input',
                                  name: 'name'
                                }
                              },
                              {
                                label: '联系人姓名',
                                elements: {
                                  eType: 'input',
                                  name: 'contactName'
                                }
                              },
                              {
                                label: '联系手机',
                                elements: {
                                  eType: 'input',
                                  name: 'phoneNumber'
                                }
                              },
                            ]
                          },
                          table: {
                            checkboxType: 'radio',
                            templates: [
                              {
                                id: 'tSchoolVerifyIn',
                                content: '[[ d.school.verify === \'{{ VerifyStatus.ok }}\' ? \'是\' : \'否\' ]]'
                              },
                              {
                                id: 'tProvinceName',
                                content: '[[ d.county.city.province.name ]]'
                              },
                              {
                                id: 'tAvatar',
                                content: '[[# if (d.avatar) { ]]<a href="[[ d.avatar ]]" style="cursor: pointer;" target="_blank"><img class="tableImg" src="[[ d.avatar ]]"></a>[[# } ]]'
                              },
                              {
                                id: 'tIsComplemented',
                                content: '[[# if (d.isComplemented) { ]]是[[# } else { ]]否[[# } ]]'
                              },
                            ],
                            config: {
                              elem: '#school',
                              url: '/member/school/table',
                              cols: [
                                [
                                  {field: 'id', title: 'ID', align: 'center', show: false, sort: true, width: 100},
                                  {field: 'account', title: '学校编号', align: 'center', sort: true, minWidth: 140},
                                  {field: 'name', title: '学校名称', align: 'center', sort: true, minWidth: 250},
                                  {field: 'schoolVerifyIn', sort: true, title: '会员学校', width:100, align: 'center', templet: '#tSchoolVerifyIn'},
                                  {field: 'provinceName', title: '大陆省份', align: 'center', sort: true, minWidth: 150, templet: '#tProvinceName'},
                                  {field: 'contactName', title: '联系人姓名', align: 'center', sort: true, minWidth: 140},
                                  {field: 'phoneNumber', title: '联系手机', align: 'center', sort: true, width: 120},
                                  {field: 'email', title: 'Email', align: 'center', sort: true, minWidth: 100},
                                  {field: 'wechat', title: '微信号', align: 'center', show: false, sort: true, minWidth: 100},
                                  {field: 'qq', title: 'QQ', align: 'center', show: false, sort: true, minWidth: 100},
                                  {field: 'avatar', title: '头像', align: 'center', show: false, sort: true, width: 80, templet: '#tAvatar'},
                                  {field: 'isComplemented', title: '完善信息', align: 'center', show: false, sort: true, width: 100, templet: '#tIsComplemented'},
                                ]
                              ],
                            }
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'input',
                  name: 'schoolId',
                  show: false,
                  layVerify: 'schRqd|required'
                }
              ]
            },
          ],
          verify: {
            select: function (value) {
              if (value === '' || value === 'null') return '必填项不能为空'
            },
            schRqd: function (value) {
              if (value === '') return '学校不能为空'
            },
          }
        }
      })
      {% elif curMember.type == MemberType.school %}
      newForm({
        parent: '#myForm1',
        form: {
          labelWidth: '120',
          done: function () {
            $('[lay-filter="myForm1Submit"]').css('marginTop', 30)
          },
          submit: {
            'class': 'layui-btn brownBtn layui-btn-lg lgWidth',
            event: function (data) {
              $('[lay-filter="myForm1Submit"]').attr('disabled', true)
              $('[lay-filter="myForm1Submit"]').addClass('layui-btn-disabled')
              ajax({
                method: 'POST',
                url: '/member-center/info-edit',
                data: JSON.stringify(data.field),
                success: function () {
                  layui.layer.msg('操作成功',{ time: 1000 })
                  window.setTimeout(function () {
                    location.href = '/member-center/info'
                  }, 1100)
                  // layer.msg('修改成功', {time: 2000, icon:6})
                  // parent.tableRender()
                  // window.setTimeout(function () {parent.layer.close(parent.layer.getFrameIndex(window.name))}, 2000)
                },
                fail: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                },
                error: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                }
              })
            }
          },
          val: {
            'country': '{{ curMember.country.number }}',
            {% if curMember.country.number == '1' %}
            'province': '{{ curMember.county.city.province.id }}',
            'city': '{{ curMember.county.city.id }}',
            'countyId': '{{ curMember.county.id }}',
            {% else %}
            'areaDetail': '{{ curMember.areaDetail }}',
            {% endif %}
            'name': '{{ curMember.name }}',
            'contactName': '{{ curMember.contactName }}',
            'phoneNumber': '{{ curMember.phoneNumber }}',
            'email': '{{ curMember.email }}',
            'wechat': '{{ curMember.wechat }}',
            'qq': '{{ curMember.qq }}',
            'intro': decodeURIComponent('{{ curMember.intro }}'),
            'avatar': '{{ curMember.avatar }}',
          },
          items: [
            {
              label: '地址',
              show: '{{ curMember.country.number }}' === '1' ? true : false,
              elements: [
                {
                  eType: 'select',
                  name: 'province',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for province in provinces %}
                    {value: '{{ province.id }}', label: '{{ province.name }}'},
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value !== '' && data.value !== 'null') ajax({
                          method: 'GET',
                          url: '/shared/city/json?provinceId=' + data.value,
                          success: function (res) {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in res) if (res.hasOwnProperty(i)) opts += '<option value="' + res[i].id + '">' + res[i].name + '</option>'
                            $('[name=city]').html(opts)
                            $('[name=countyId]').html('<option value="null" selected>请选择</option>')
                            form.render('select')
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'select',
                  name: 'city',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for city in cities %}
                    {value: '{{ city.id }}', label: '{{ city.name }}'},
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value !== '' && data.value !== 'null') ajax({
                          method: 'GET',
                          url: '/shared/county/json?cityId=' + data.value,
                          success: function (res) {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in res) if (res.hasOwnProperty(i)) opts += '<option value="' + res[i].id + '">' + res[i].name + '</option>'
                            $('[name=countyId]').html(opts)
                            form.render('select')
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'select',
                  name: 'countyId',
                  // layVerify: 'place',
                  layVerify: 'select',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for county in counties %}
                    {value: '{{ county.id }}', label: '{{ county.name }}'},
                    {% endfor %}
                  ],
                }
              ]
            },
            {
              label: '名称',
              elements: {
                eType: 'input',
                name: 'name',
                layVerify: 'required'
              }
            },
            {
              label: '联系人',
              elements: {
                eType: 'input',
                name: 'contactName',
                layVerify: 'required'
              }
            },
            {
              label: '联系手机',
              elements: {
                eType: 'input',
                name: 'phoneNumber',
                layVerify: 'required|phone'
              }
            },
            {
              label: 'Email',
              elements: {
                eType: 'input',
                name: 'email',
                layVerify: ''
              }
            },
            {
              label: '微信号',
              elements: {
                eType: 'input',
                name: 'wechat',
                layVerify: ''
              }
            },
            {
              label: 'QQ',
              elements: {
                eType: 'input',
                name: 'qq',
                layVerify: ''
              }
            },
            {
              label: '简介',
              elements: {
                eType: 'textarea',
                name: 'intro',
                layVerify: ''
              }
            },
            {
              label: '头像',
              elements: {
                eType: 'file',
                name: 'avatar',
                btnClass: 'layui-btn greenBtn'
              }
            },
          ],
          verify: {
            select: function (value) {
              if (value === '' || value === 'null') return '必填项不能为空'
            },
            place: function (value) {
              if ($('[name=countryNumber]').val() === '1' && (value === '' || value === 'null' || value == null)) return '地址不能为空'
            },
            areaDetail: function (value) {
              if ($('[name=countryNumber]').val() !== '1' && value === '') return '地区不能为空'
            }
          }
        }
      })
      {% elif curMember.type == MemberType.whGroup %}
      newForm({
        parent: '#myForm1',
        form: {
          labelWidth: '120',
          done: function () {
            $('[lay-filter="myForm1Submit"]').css('marginTop', 30)
          },
          submit: {
            'class': 'layui-btn brownBtn layui-btn-lg lgWidth',
            event: function (data) {
              $('[lay-filter="myForm1Submit"]').attr('disabled', true)
              $('[lay-filter="myForm1Submit"]').addClass('layui-btn-disabled')
              ajax({
                method: 'POST',
                url: '/member-center/info-edit',
                data: JSON.stringify(data.field),
                success: function () {
                  layui.layer.msg('操作成功',{ time: 1000 })
                  window.setTimeout(function () {
                    location.href = '/member-center/info'
                  }, 1100)
                  // layer.msg('修改成功', {time: 2000, icon:6})
                  // parent.tableRender()
                  // window.setTimeout(function () {parent.layer.close(parent.layer.getFrameIndex(window.name))}, 2000)
                },
                fail: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                },
                error: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                }
              })
            }
          },
          val: {
            'countryNumber': '{{ curMember.country.number }}',
            {% if curMember.country.number == '1' %}
            'province': '{{ curMember.county.city.province.id }}',
            'city': '{{ curMember.county.city.id }}',
            'countyId': '{{ curMember.county.id }}',
            {% else %}
            'areaDetail': '{{ curMember.areaDetail }}',
            {% endif %}
            'name': '{{ curMember.name }}',
            'contactName': '{{ curMember.contactName }}',
            'phoneNumber': '{{ curMember.phoneNumber }}',
            'email': '{{ curMember.email }}',
            'wechat': '{{ curMember.wechat }}',
            'qq': '{{ curMember.qq }}',
            'intro': decodeURIComponent('{{ curMember.intro }}'),
            'avatar': '{{ curMember.avatar }}',
          },
          items: [
            {
              label: '国家及地区',
              elements: {
                eType: 'select',
                name: 'countryNumber',
                layVerify: 'select',
                laySearch: true,
                option: [
                  {value: 'null', label: '请选择'},
                  {% for country in countries %}
                  {value: '{{ country.number }}', label: '{{ country.name }}'},
                  {% endfor %}
                ],
                events: [
                  {
                    name: 'laySelect',
                    callback: function (data) {
                      if (data.value === '1') {
                        $('[name=province]').parents('[m-if]').attr('m-if', 'true')
                        $('[name=areaDetail]').parents('[m-if]').attr('m-if', 'false')
                        mIfRender()
                      } else {
                        $('[name=province]').parents('[m-if]').attr('m-if', 'false')
                        $('[name=areaDetail]').parents('[m-if]').attr('m-if', 'true')
                        mIfRender()
                      }
                    }
                  }
                ]
              }
            },
            {
              label: '地址',
              show: '{{ curMember.country.number }}' === '1' ? true : false,
              elements: [
                {
                  eType: 'select',
                  name: 'province',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for province in provinces %}
                    {value: '{{ province.id }}', label: '{{ province.name }}'},
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value !== '' && data.value !== 'null') ajax({
                          method: 'GET',
                          url: '/shared/city/json?provinceId=' + data.value,
                          success: function (res) {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in res) if (res.hasOwnProperty(i)) opts += '<option value="' + res[i].id + '">' + res[i].name + '</option>'
                            $('[name=city]').html(opts)
                            $('[name=countyId]').html('<option value="null" selected>请选择</option>')
                            form.render('select')
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'select',
                  name: 'city',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for city in cities %}
                    {value: '{{ city.id }}', label: '{{ city.name }}'},
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value !== '' && data.value !== 'null') ajax({
                          method: 'GET',
                          url: '/shared/county/json?cityId=' + data.value,
                          success: function (res) {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in res) if (res.hasOwnProperty(i)) opts += '<option value="' + res[i].id + '">' + res[i].name + '</option>'
                            $('[name=countyId]').html(opts)
                            form.render('select')
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'select',
                  name: 'countyId',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for county in counties %}
                    {value: '{{ county.id }}', label: '{{ county.name }}'},
                    {% endfor %}
                  ],
                }
              ]
            },
            {
              label: '地区',
              show: '{{ curMember.country.number }}' !== '1' ? true : false,
              elements: {
                eType: 'input',
                name: 'areaDetail',
                layVerify: 'areaDetail'
              }
            },
            {
              label: '名称',
              elements: {
                eType: 'input',
                name: 'name',
                layVerify: 'required'
              }
            },
            {
              label: '联系人',
              elements: {
                eType: 'input',
                name: 'contactName',
                layVerify: 'required'
              }
            },
            {
              label: '联系手机',
              elements: {
                eType: 'input',
                name: 'phoneNumber',
                layVerify: 'required|phone'
              }
            },
            {
              label: 'Email',
              elements: {
                eType: 'input',
                name: 'email',
                layVerify: ''
              }
            },
            {
              label: '微信号',
              elements: {
                eType: 'input',
                name: 'wechat',
                layVerify: ''
              }
            },
            {
              label: 'QQ',
              elements: {
                eType: 'input',
                name: 'qq',
                layVerify: ''
              }
            },
            {
              label: '简介',
              elements: {
                eType: 'textarea',
                name: 'intro',
                layVerify: ''
              }
            },
            {
              label: '头像',
              elements: {
                eType: 'file',
                name: 'avatar',
                btnClass: 'layui-btn greenBtn'
              }
            },
          ],
          verify: {
            select: function (value) {
              if (value === '' || value === 'null') return '必填项不能为空'
            },
            place: function (value) {
              if ($('[name=countryNumber]').val() === '1' && (value === '' || value === 'null' || value == null)) return '地址不能为空'
            },
            areaDetail: function (value) {
              if ($('[name=countryNumber]').val() !== '1' && value === '') return '地区不能为空'
            }
          }
        }
      })
      {% elif curMember.type == MemberType.whPerson %}
      newForm({
        parent: '#myForm1',
        form: {
          labelWidth: '120',
          done: function () {
            $('[lay-filter="myForm1Submit"]').css('marginTop', 30)
          },
          submit: {
            'class': 'layui-btn brownBtn layui-btn-lg lgWidth',
            event: function (data) {
              $('[lay-filter="myForm1Submit"]').attr('disabled', true)
              $('[lay-filter="myForm1Submit"]').addClass('layui-btn-disabled')
              ajax({
                method: 'POST',
                url: '/member-center/info-edit',
                data: JSON.stringify(data.field),
                success: function () {
                  layui.layer.msg('操作成功',{ time: 1000 })
                  window.setTimeout(function () {
                    location.href = '/member-center/info'
                  }, 1100)
                  // layer.msg('修改成功', {time: 2000, icon:6})
                  // parent.tableRender()
                  // window.setTimeout(function () {parent.layer.close(parent.layer.getFrameIndex(window.name))}, 2000)
                },
                fail: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                },
                error: function () {
                  $('[lay-filter="myForm1Submit"]').attr('disabled', false)
                  $('[lay-filter="myForm1Submit"]').removeClass('layui-btn-disabled')
                }
              })
            }
          },
          val: {
            'countryNumber': '{{ curMember.country.number }}',
            {% if curMember.country.number == '1' %}
            'province': '{{ curMember.county.city.province.id }}',
            'city': '{{ curMember.county.city.id }}',
            'countyId': '{{ curMember.county.id }}',
            {% else %}
            'areaDetail': '{{ curMember.areaDetail }}',
            {% endif %}
            'name': '{{ curMember.name }}',
            'nickName': '{{ curMember.nickName }}',
            'gender': '{{ curMember.gender }}',
            'idCard': '{{ curMember.idCard }}',
            'phoneNumber': '{{ curMember.phoneNumber }}',
            'email': '{{ curMember.email }}',
            'wechat': '{{ curMember.wechat }}',
            'qq': '{{ curMember.qq }}',
            'avatar': '{{ curMember.avatar }}',
            'intro': decodeURIComponent('{{ curMember.intro }}'),
            'groupId': '{{ curMember.whPerson.whGroup.id }}',
          },
          items: [
            {
              label: '国家及地区',
              elements: {
                eType: 'select',
                name: 'countryNumber',
                layVerify: 'select',
                laySearch: true,
                option: [
                  {value: 'null', label: '请选择'},
                  {% for country in countries %}
                  {value: '{{ country.number }}', label: '{{ country.name }}'},
                  {% endfor %}
                ],
                events: [
                  {
                    name: 'laySelect',
                    callback: function (data) {
                      if (data.value === '1') {
                        $('[name=province]').parents('[m-if]').attr('m-if', 'true')
                        $('[name=areaDetail]').parents('[m-if]').attr('m-if', 'false')
                        mIfRender()
                      } else {
                        $('[name=province]').parents('[m-if]').attr('m-if', 'false')
                        $('[name=areaDetail]').parents('[m-if]').attr('m-if', 'true')
                        mIfRender()
                      }
                    }
                  }
                ]
              }
            },
            {
              label: '地址',
              show: '{{ curMember.country.number }}' === '1' ? true : false,
              elements: [
                {
                  eType: 'select',
                  name: 'province',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for province in provinces %}
                    {value: '{{ province.id }}', label: '{{ province.name }}'},
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value !== '' && data.value !== 'null') ajax({
                          method: 'GET',
                          url: '/shared/city/json?provinceId=' + data.value,
                          success: function (res) {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in res) if (res.hasOwnProperty(i)) opts += '<option value="' + res[i].id + '">' + res[i].name + '</option>'
                            $('[name=city]').html(opts)
                            $('[name=countyId]').html('<option value="null" selected>请选择</option>')
                            form.render('select')
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'select',
                  name: 'city',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for city in cities %}
                    {value: '{{ city.id }}', label: '{{ city.name }}'},
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value !== '' && data.value !== 'null') ajax({
                          method: 'GET',
                          url: '/shared/county/json?cityId=' + data.value,
                          success: function (res) {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in res) if (res.hasOwnProperty(i)) opts += '<option value="' + res[i].id + '">' + res[i].name + '</option>'
                            $('[name=countyId]').html(opts)
                            form.render('select')
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'select',
                  name: 'countyId',
                  layVerify: 'place',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for county in counties %}
                    {value: '{{ county.id }}', label: '{{ county.name }}'},
                    {% endfor %}
                  ],
                }
              ]
            },
            {
              label: '地区',
              show: '{{ curMember.country.number }}' !== '1' ? true : false,
              elements: {
                eType: 'input',
                name: 'areaDetail',
                layVerify: 'areaDetail'
              }
            },
            {
              label: '姓名',
              elements: {
                eType: 'input',
                name: 'name',
                layVerify: 'required'
              }
            },
            {
              label: '昵称',
              elements: {
                eType: 'input',
                name: 'nickName',
                layVerify: 'required'
              }
            },
            {
              label: '性别',
              elements: {
                eType: 'select',
                name: 'gender',
                option: [
                  {value: 'null', label: '请选择'},
                  {% for i, j in Gender %}
                  {value: '{{ j }}', label: '{{ j }}'},
                  {% endfor %}
                ],
              }
            },
            {
              label: '身份证号',
              elements: {
                eType: 'input',
                name: 'idCard',
              }
            },
            {
              label: '联系手机',
              elements: {
                eType: 'input',
                name: 'phoneNumber',
                layVerify: 'required|phone'
              }
            },
            {
              label: 'Email',
              elements: {
                eType: 'input',
                name: 'email',
                layVerify: ''
              }
            },
            {
              label: '微信号',
              elements: {
                eType: 'input',
                name: 'wechat',
                layVerify: ''
              }
            },
            {
              label: 'QQ',
              elements: {
                eType: 'input',
                name: 'qq',
                layVerify: ''
              }
            },
            {
              label: '简介',
              elements: {
                eType: 'textarea',
                name: 'intro',
                layVerify: ''
              }
            },
            {
              label: '头像',
              elements: {
                eType: 'file',
                name: 'avatar',
                btnClass: 'layui-btn greenBtn'
              }
            },
            {
              label: '爱心团体',
              elements: [
                {
                  eType: 'char',
                  name: 'whGroupShow',
                  element: '<div class="layui-form-label"><button type="button" class="inblk layui-btn layui-btn-primary">修改爱心团体</button></div><div class="layui-input-block whGroups" style="">{{ curMember.whPerson.whGroup.member.name }}</div>',
                  events: [
                    {
                      type: 'delegate',
                      name: 'click',
                      query: 'button',
                      callback: function (e) {
                        var index = layer.open({
                          type: 1,
                          title: '选择爱心团体',
                          offset: ['5px', '5px'],
                          skin: 'layui-layer-rim',
                          area: [(document.body.clientWidth - 20) + 'px', (document.body.clientHeight - 20) + 'px'],
                          content: '<div id="chooseWhp"></div>',
                          maxmin: true
                        })
                        newTable({
                          parent: '#chooseWhp',
                          btns: {
                            items: [
                              {
                                layEvent: 'backWhp',
                                'class': 'layui-btn greenBtn',
                                label: '确认选择',
                                event: function (obj, config, render) {
                                  var data = table.checkStatus(config.id).data
                                  if (data.length === 0) layer.close(index)
                                  else if (data.length > 0) {
                                    $('[name=groupId]').val(data[0].whGroup.id)
                                    $('.whGroups').html(data[0].name)
                                    layer.close(index)
                                  }
                                }
                              },
                              {
                                layEvent: 'cancelWhp',
                                label: '取消',
                                event: function (obj, config, render) {layer.close(index)}
                              }
                            ]
                          },
                          search: {
                            'class': 'selects',
                            labelWidth: '100',
                            submit: {
                              'class': 'layui-btn greenBtn'
                            },
                            items: [
                              {
                                label: '团体账号',
                                elements: {
                                  eType: 'input',
                                  name: 'account'
                                }
                              },
                              {
                                label: '团体名称',
                                elements: {
                                  eType: 'input',
                                  name: 'name'
                                }
                              },
                              {
                                label: '联系人姓名',
                                elements: {
                                  eType: 'input',
                                  name: 'contactName'
                                }
                              },
                              {
                                label: '联系手机',
                                elements: {
                                  eType: 'input',
                                  name: 'phoneNumber'
                                }
                              },
                            ]
                          },
                          table: {
                            checkboxType: 'radio',
                            templates: [
                              {
                                id: 'tProvinceName',
                                content: '[[ d.county != null ? d.county.city.province.name : \'\' ]]'
                              },
                              {
                                id: 'tAvatar',
                                content: '[[# if (d.avatar) { ]]<a href="[[ d.avatar ]]" style="cursor: pointer;" target="_blank"><img class="tableImg" src="[[ d.avatar ]]"></a>[[# } ]]'
                              },
                              {
                                id: 'tIsComplemented',
                                content: '[[# if (d.isComplemented) { ]]是[[# } else { ]]否[[# } ]]'
                              },
                            ],
                            config: {
                              elem: '#whGroup',
                              url: '/member/whGroup/table',
                              cols: [
                                [
                                  {field: 'id', title: 'ID', align: 'center', show: false, sort: true, width: 100},
                                  {field: 'account', title: '团体账号', align: 'center', sort: true, minWidth: 140},
                                  {field: 'name', title: '团体名称', align: 'center', sort: true, minWidth: 140},
                                  {field: 'provinceName', title: '大陆省份', align: 'center', sort: true, minWidth: 150, templet: '#tProvinceName'},
                                  {field: 'contactName', title: '联系人姓名', align: 'center', sort: true, minWidth: 140},
                                  {field: 'phoneNumber', title: '联系手机', align: 'center', sort: true, width: 120},
                                  {field: 'email', title: 'Email', align: 'center', sort: true, minWidth: 100},
                                  {field: 'wechat', title: '微信号', align: 'center', show: false, sort: true, minWidth: 100},
                                  {field: 'qq', title: 'QQ', align: 'center', show: false, sort: true, minWidth: 100},
                                  {field: 'avatar', title: '头像', align: 'center', show: false, sort: true, width: 80, templet: '#tAvatar'},
                                  {field: 'isComplemented', title: '完善信息', align: 'center', show: false, sort: true, width: 100, templet: '#tIsComplemented'},
                                ]
                              ],
                            }
                          }
                        })
                      }
                    }
                  ]
                },
                {
                  eType: 'input',
                  name: 'groupId',
                  show: false,
                  layVerify: 'whpRqd|required'
                }
              ]
            },
          ],
          verify: {
            select: function (value) {
              if (value === '' || value === 'null') return '必填项不能为空'
            },
            place: function (value) {
              if ($('[name=countryNumber]').val() === '1' && (value === '' || value === 'null' || value == null)) return '地址不能为空'
            },
            areaDetail: function (value) {
              if ($('[name=countryNumber]').val() !== '1' && value === '') return '地区不能为空'
            },
            whpRqd: function (value) {
              if (value === '') return '爱心团体不能为空'
            },
          }
        }
      })
      {% endif %}

      {% if curMember.type == MemberType.student %}
        newForm({
          parent: '#myForm2',
          form: {
            labelWidth: '120',
            done: function () {
              $('[lay-filter="myForm2Submit"]').css('marginTop', 30)
            },
            submit: {
              'class': 'layui-btn brownBtn layui-btn-lg lgWidth',
              {% if curMember.student.status === StudentStatus.wait %}
              show: false,
              {% endif %}
              event: function (data) {
                $('[lay-filter="myForm2Submit"]').attr('disabled', true)
                $('[lay-filter="myForm2Submit"]').addClass('layui-btn-disabled')
                ajax({
                  method: 'POST',
                  url: '/member-center/info-edit-apply',
                  data: JSON.stringify(data.field),
                  success: function () {
                    layui.layer.msg('操作成功',{ time: 1000 })
                    window.setTimeout(function () {
                      location.href = '/member-center/info'
                    }, 1100)
                    // layer.msg('修改成功', {time: 2000, icon:6})
                    // parent.tableRender()
                    // window.setTimeout(function () {parent.layer.close(parent.layer.getFrameIndex(window.name))}, 2000)
                  },
                  fail: function () {
                    $('[lay-filter="myForm2Submit"]').attr('disabled', false)
                    $('[lay-filter="myForm2Submit"]').removeClass('layui-btn-disabled')
                  },
                  error: function () {
                    $('[lay-filter="myForm2Submit"]').attr('disabled', false)
                    $('[lay-filter="myForm2Submit"]').removeClass('layui-btn-disabled')
                  }
                })
              }
            },
            val: {
              'applySchoolId': '{{ curMember.student.applySchool.id }}',
              'applyPeriod': '{{ curMember.student.applyPeriod }}',
              'applyGrade': '{{ curMember.student.applyGrade }}',
              'applyClass': '{{ curMember.student.applyClass }}',
              'info': '{{ curMember.student.info }}',
            },
            items: [
              {% if curMember.student.status === StudentStatus.wait %}
              {
                label: '状态',
                elements: {
                  eType: 'char',
                  name: 'status',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.status }}</div>'
                }
              },
              {
                label: '学校',
                elements: {
                  eType: 'char',
                  name: 'applySchoolId',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.applySchool.member.name }}</div>'
                }
              },
              {
                label: '学段',
                elements: {
                  eType: 'char',
                  name: 'applyPeriod',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.applyPeriod }}</div>'
                }
              },
              {
                label: '年级',
                elements: {
                  eType: 'char',
                  name: 'applyGrade',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.applyGrade }}</div>'
                }
              },
              {
                label: '班级',
                elements: {
                  eType: 'char',
                  name: 'applyClass',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.applyClass }}</div>'
                }
              },
              {
                label: '申请原因',
                elements: {
                  eType: 'char',
                  name: 'info',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.info }}</div>'
                }
              },
              {% else %}
              {%if curMember.student.status === StudentStatus.revamp %}
              {
                label: '状态',
                elements: {
                  eType: 'char',
                  name: 'status',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.status }}</div>'
                }
              },
              {
                label: '复议理由',
                elements: {
                  eType: 'char',
                  name: 'reason',
                  element: '<div class="layui-input-block" style="">{{ curMember.student.reason }}</div>'
                }
              },
              {% endif %}
              {
                label: '学校',
                elements: [
                  {
                    eType: 'char',
                    name: 'schoolShow',
                    element: '<div class="layui-form-label"><button type="button" class="inblk layui-btn layui-btn-primary">修改学校</button></div><div class="layui-input-block schools" style="">{{ curMember.student.applySchool.member.name if curMember.student.applySchool != null else "请选择学校" }}</div>',
                    events: [
                      {
                        type: 'delegate',
                        name: 'click',
                        query: 'button',
                        callback: function (e) {
                          var index = layer.open({
                            type: 1,
                            title: '选择学校',
                            offset: ['5px', '5px'],
                            skin: 'layui-layer-rim',
                            area: [(document.body.clientWidth - 20) + 'px', (document.body.clientHeight - 20) + 'px'],
                            content: '<div id="chooseSch"></div>',
                            maxmin: true
                          })
                          newTable({
                            parent: '#chooseSch',
                            btns: {
                              items: [
                                {
                                  layEvent: 'backSch',
                                  'class': 'layui-btn greenBtn',
                                  label: '确认选择',
                                  event: function (obj, config, render) {
                                    var data = table.checkStatus(config.id).data
                                    if (data.length === 0) layer.close(index)
                                    else if (data.length > 0) {
                                      $('[name=applySchoolId]').val(data[0].school.id)
                                      $('.schools').html(data[0].name)
                                      layer.close(index)
                                    }
                                  }
                                },
                                {
                                  layEvent: 'cancelSch',
                                  label: '取消',
                                  event: function (obj, config, render) {layer.close(index)}
                                }
                              ]
                            },
                            search: {
                              'class': 'selects',
                              labelWidth: '100',
                              submit: {
                                'class': 'layui-btn greenBtn'
                              },
                              items: [
                                {
                                  label: '会员学校',
                                  elements: {
                                    eType: 'select',
                                    name: 'schoolVerifyIn',
                                    option: [
                                      {value: 'all', label: '&nbsp;', selected: true},
                                      {value: '{{ VerifyStatus.ok }}', label: '是'},
                                      {value: '{{ VerifyStatus.wait }},{{ VerifyStatus.no }}', label: '否'},
                                    ]
                                  }
                                },
                                {
                                  label: '学校编号',
                                  elements: {
                                    eType: 'input',
                                    name: 'account'
                                  }
                                },
                                {
                                  label: '学校名称',
                                  elements: {
                                    eType: 'input',
                                    name: 'name'
                                  }
                                },
                                {
                                  label: '联系人姓名',
                                  elements: {
                                    eType: 'input',
                                    name: 'contactName'
                                  }
                                },
                                {
                                  label: '联系手机',
                                  elements: {
                                    eType: 'input',
                                    name: 'phoneNumber'
                                  }
                                },
                              ]
                            },
                            table: {
                              checkboxType: 'radio',
                              templates: [
                                {
                                  id: 'tSchoolVerifyIn',
                                  content: '[[ d.school.verify === \'{{ VerifyStatus.ok }}\' ? \'是\' : \'否\' ]]'
                                },
                                {
                                  id: 'tProvinceName',
                                  content: '[[ d.county.city.province.name ]]'
                                },
                                {
                                  id: 'tAvatar',
                                content: '[[# if (d.avatar) { ]]<a href="[[ d.avatar ]]" style="cursor: pointer;" target="_blank"><img class="tableImg" src="[[ d.avatar ]]"></a>[[# } ]]'
                                },
                                {
                                  id: 'tIsComplemented',
                                  content: '[[# if (d.isComplemented) { ]]是[[# } else { ]]否[[# } ]]'
                                },
                              ],
                              config: {
                                elem: '#applySchool',
                                url: '/member/school/table',
                                cols: [
                                  [
                                    {field: 'id', title: 'ID', align: 'center', show: false, sort: true, width: 100},
                                    {field: 'account', title: '学校编号', align: 'center', sort: true, minWidth: 140},
                                    {field: 'name', title: '学校名称', align: 'center', sort: true, minWidth: 250},
                                    {field: 'schoolVerifyIn', sort: true, title: '会员学校', width:100, align: 'center', templet: '#tSchoolVerifyIn'},
                                    {field: 'provinceName', title: '大陆省份', align: 'center', sort: true, minWidth: 150, templet: '#tProvinceName'},
                                    {field: 'contactName', title: '联系人姓名', align: 'center', sort: true, minWidth: 140},
                                    {field: 'phoneNumber', title: '联系手机', align: 'center', sort: true, width: 120},
                                    {field: 'email', title: 'Email', align: 'center', sort: true, minWidth: 100},
                                    {field: 'wechat', title: '微信号', align: 'center', show: false, sort: true, minWidth: 100},
                                    {field: 'qq', title: 'QQ', align: 'center', show: false, sort: true, minWidth: 100},
                                    {field: 'avatar', title: '头像', align: 'center', show: false, sort: true, width: 80, templet: '#tAvatar'},
                                    {field: 'isComplemented', title: '完善信息', align: 'center', show: false, sort: true, width: 100, templet: '#tIsComplemented'},
                                  ]
                                ],
                              }
                            }
                          })
                        }
                      }
                    ]
                  },
                  {
                    eType: 'input',
                    name: 'applySchoolId',
                    show: false,
                    layVerify: 'schRqd|required'
                  }
                ]
              },
              {
                label: '学段',
                elements: {
                  eType: 'select',
                  name: 'applyPeriod',
                  layVerify: 'select',
                  laySearch: true,
                  option: [
                    {value: 'null', label: '请选择'},
                    {% for i, j in StudentPeriod %}
                    {% if i != 'LiXiao' %}{value: '{{ j }}', label: '{{ j }}'},{% endif %}
                    {% endfor %}
                  ],
                  events: [
                    {
                      name: 'laySelect',
                      callback: function (data) {
                        if (data.value === '{{ StudentPeriod.XiaoXue }}') {
                          var applyGrade = $('[name=applyGrade]').val() * 1
                          var opts = '<option value="null">请选择</option>'
                          for (var i in [1, 2, 3, 4, 5, 6]) if ([1, 2, 3, 4, 5, 6].hasOwnProperty(i)) {
                            if (i * 1 + 1 === applyGrade) opts += '<option value="' + (i * 1 + 1) + '" selected>' + (i * 1 + 1)+ '</option>'
                            else opts += '<option value="' + (i * 1 + 1) + '">' + (i * 1 + 1)+ '</option>'
                          }
                          $('[name=applyGrade]').html(opts)
                          form.render('select')
                        } else {
                          var applyGrade = $('[name=applyGrade]').val() * 1
                          if (applyGrade <= 3) {
                            var opts = '<option value="null">请选择</option>'
                            for (var i in [1, 2, 3]) if ([1, 2, 3].hasOwnProperty(i)) {
                              if (i * 1 + 1 === applyGrade) opts += '<option value="' + (i * 1 + 1) + '" selected>' + (i * 1 + 1)+ '</option>'
                              else opts += '<option value="' + (i * 1 + 1) + '">' + (i * 1 + 1)+ '</option>'
                            }
                            $('[name=applyGrade]').html(opts)
                            form.render('select')
                          } else {
                            var opts = '<option value="null" selected>请选择</option>'
                            for (var i in [1, 2, 3]) if ([1, 2, 3].hasOwnProperty(i)) {
                              opts += '<option value="' + (i * 1 + 1) + '">' + (i * 1 + 1)+ '</option>'
                            }
                            $('[name=applyGrade]').html(opts)
                            form.render('select')
                          }
                        }
                      }
                    }
                  ]
                }
              },
              {
                label: '年级',
                elements: {
                  eType: 'select',
                  name: 'applyGrade',
                  layVerify: 'select',
                  option: [
                    {value: 'null', label: '请选择'},
                    {% if curMember.student.period == StudentPeriod.XiaoXue %}
                    {value: '1', label: '1'},
                    {value: '2', label: '2'},
                    {value: '3', label: '3'},
                    {value: '4', label: '4'},
                    {value: '5', label: '5'},
                    {value: '6', label: '6'},
                    {% else %}
                    {value: '1', label: '1'},
                    {value: '2', label: '2'},
                    {value: '3', label: '3'},
                    {% endif %}
                  ]
                }
              },
              {
                label: '班级',
                elements: {
                  eType: 'input',
                  name: 'applyClass',
                  layVerify: 'required'
                }
              },
              {
                label: '申请原因',
                elements: {
                  eType: 'textarea',
                  name: 'info',
                  layVerify: 'required'
                }
              },
              {% endif %}
            ],
            verify: {
              select: function (value) {
                if (value === '' || value === 'null') return '必填项不能为空'
              },
              schRqd: function (value) {
                if (value === '') return '学校不能为空'
              },
            }
          }
        })
      {% endif %}

      // mIfRender()
      // mBindRender()

      // // 国家及地区 下拉列表
      // $('#country').on('change', function(e) {
      //   if (e.target.value === '1') {
      //     isChina = true
      //   } else {
      //     isChina = false
      //   }
      //   mIfRender()
      //   mBindRender()
      // })

      // {% if curMember.type == MemberType.student %}
      // // 上传照片
      // layui.upload.render({
      //   elem: '#btn-photo',
      //   url: '/upload/',
      //   done: function(res){
      //     $('#img-photo')[0].src = res.url
      //     $('input[name=photo]').val(res.url)
      //   },
      //   error: function(){
      //   }
      // })

      // {% endif %}

      // // 上传头像
      // layui.upload.render({
      //   elem: '#btn-avatar',
      //   url: '/upload/',
      //   done: function(res){
      //     $('#img-avatar')[0].src = res.url
      //     $('input[name=avatar]').val(res.url)
      //   },
      //   error: function(){
      //   }
      // })


      // var allCities = {}
      // var allCounties = {}

      // // 换市下拉列表
      // function changeCities(cities) {
      //   var htmlStr = '<option disabled selected>请选择</option>'
      //   for (var key in cities) {
      //     if (cities.hasOwnProperty(key)) {
      //       var city = cities[key]
      //       htmlStr += '<option value="' + city.id + '">' + city.name + '</option>'
      //     }
      //   }
      //   $('#city').html(htmlStr)
      // }

      // // 换区县下拉列表
      // function changeCounties(counties) {
      //   var htmlStr = '<option disabled selected>请选择</option>'
      //   for (var key in counties) {
      //     if (counties.hasOwnProperty(key)) {
      //       var county = counties[key]
      //       htmlStr += '<option value="' + county.id + '">' + county.name + '</option>'
      //     }
      //   }
      //   $('#county').html(htmlStr)
      // }

      // // 省 下拉列表
      // $('#province').on('change', function(e) {
      //   var provinceId = e.target.value
      //   if (allCities[provinceId]) {
      //     changeCities(allCities[provinceId])
      //     changeCounties([])
      //   } else {
      //     ajax({
      //       method: 'GET',
      //       url: '/shared/city/json?provinceId=' + provinceId,
      //       success: function (data) {
      //         allCities[provinceId] = data
      //         changeCities(allCities[provinceId])
      //         changeCounties([])
      //       }
      //     })
      //   }
      // })

      // // 市 下拉列表
      // $('#city').on('change', function(e) {
      //   var cityId = e.target.value
      //   if (allCounties[cityId]) {
      //     changeCounties(allCounties[cityId])
      //   } else {
      //     ajax({
      //       method: 'GET',
      //       url: '/shared/county/json?cityId=' + cityId,
      //       success: function (data) {
      //         allCounties[cityId] = data
      //         changeCounties(allCounties[cityId])
      //       }
      //     })
      //   }
      // })


      // $('#info-edit-form').on('submit', function(e) {
      //   if (e.target !== this) {
      //     return true
      //   }
      //   e.preventDefault()
      //   $('#info-edit-form-submit').attr('disabled', true)
      //   ajax({
      //     method: 'POST',
      //     url: '/member-center/info-edit',
      //     data: JSON.stringify(getFormData('#info-edit-form')),
      //     success: function () {
      //       layui.layer.msg('操作成功',{ time: 1000 })
      //       window.setTimeout(function () {
      //         location.href = '/member-center/info'
      //       }, 1100)
      //     },
      //     fail: function () {
      //       $('#info-edit-form-submit').attr('disabled', false)
      //     }
      //   })
      // })


      // $('#info-edit-apply-form').on('submit', function(e) {
      //   if (e.target !== this) {
      //     return true
      //   }
      //   e.preventDefault()
      //   $('#info-edit-apply-form-submit').attr('disabled', true)
      //   ajax({
      //     method: 'POST',
      //     url: '/member-center/info-edit-apply',
      //     data: JSON.stringify(getFormData('#info-edit-apply-form')),
      //     success: function () {
      //       layui.layer.msg('操作成功',{ time: 1000 })
      //       window.setTimeout(function () {
      //         location.href = '/member-center/info'
      //       }, 1100)
      //     },
      //     fail: function () {
      //       $('#info-edit-apply-form-submit').attr('disabled', false)
      //     }
      //   })
      // })

    })
  </script>
{% endblock %}
